<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Oxanium:wght@300;400;600;700;800&display=swap');

        * { margin:0; padding:0; box-sizing:border-box; }

        :root {
            --primary-teal:#537780; --primary-teal-light:#69939D; --primary-teal-dark:#3F5A61;
            --bg-dark:#0a0e12; --bg-darker:#060809; --bg-card:#0f1419; --bg-hover:#1a2128;
            --text-primary:#ffffff; --text-secondary:#a8b8c0; --text-dim:#6b7a82;
            --accent-glow:rgba(83,119,128,0.4); --success:#00ff88; --warning:#ffaa00; --error:#ff4466;
            --border-subtle:rgba(83,119,128,0.2); --shadow-glow:0 0 30px rgba(83,119,128,0.3);
        }

        body{
            font-family:'Oxanium',monospace;
            background:linear-gradient(135deg,var(--bg-darker) 0%,var(--bg-dark) 50%,#0d1215 100%);
            color:var(--text-primary); font-size:16px; line-height:1.6; min-height:100vh; position:relative; overflow-x:hidden;
        }
        body::before{
            content:''; position:fixed; inset:0;
            background:
                    radial-gradient(circle at 20% 50%, rgba(83,119,128,.1) 0%, transparent 50%),
                    radial-gradient(circle at 80% 80%, rgba(83,119,128,.05) 0%, transparent 50%),
                    radial-gradient(circle at 40% 20%, rgba(83,119,128,.08) 0%, transparent 40%);
            pointer-events:none; z-index:1;
        }
        .draggable{ position:relative; z-index:2; animation:fadeIn .6s ease-out; }
        @keyframes fadeIn{ from{opacity:0; transform:translateY(20px)} to{opacity:1; transform:translateY(0)} }

        /* Header */
        h2{
            background:linear-gradient(135deg,var(--primary-teal-light),var(--primary-teal));
            background-clip:text; -webkit-background-clip:text; -webkit-text-fill-color:transparent;
            font-size:2.5em; font-weight:800; letter-spacing:-.5px; margin-bottom:30px; text-transform:uppercase; position:relative; padding-left:20px;
        }
        h2::before{
            content:''; position:absolute; left:0; top:50%; transform:translateY(-50%);
            width:4px; height:80%; background:linear-gradient(180deg,transparent,var(--primary-teal),transparent); border-radius:2px; animation:pulse 2s ease-in-out infinite;
        }
        @keyframes pulse{0%,100%{opacity:1}50%{opacity:.5}}

        /* Card */
        .top{
            padding:40px; background:rgba(15,20,25,.6); backdrop-filter:blur(10px);
            border:1px solid var(--border-subtle); border-radius:20px; margin:20px;
            box-shadow:0 10px 40px rgba(0,0,0,.5), inset 0 1px 0 rgba(255,255,255,.05);
        }

        /* Label / control pair */
        .left{
            display:inline-block; width:200px; margin-bottom:20px; vertical-align:top;
            color:var(--text-secondary); font-weight:600; font-size:.9em; text-transform:uppercase; letter-spacing:.5px; padding-top:12px; position:relative;
        }
        .left::after{ content:':'; position:absolute; right:10px; color:var(--primary-teal); opacity:.6; }
        .right{ display:inline-block; width:calc(100% - 220px); margin-bottom:20px; padding-right:2%; }

        /* Inputs */
        input[type="text"], input[type="number"], textarea, select{
            width:100%; padding:14px 18px;
            background:linear-gradient(135deg, rgba(6,8,9,.8) 0%, rgba(15,20,25,.8) 100%);
            border:2px solid var(--border-subtle); border-radius:12px; color:var(--text-primary);
            font-family:'Oxanium',monospace; font-size:.95em; transition:all .3s cubic-bezier(.4,0,.2,1); backdrop-filter:blur(5px);
        }
        input[type="text"]:hover, input[type="number"]:hover, textarea:hover, select:hover{
            border-color:rgba(83,119,128,.4); background:linear-gradient(135deg, rgba(6,8,9,.9) 0%, rgba(20,28,35,.9) 100%);
        }
        input[type="text"]:focus, input[type="number"]:focus, textarea:focus, select:focus{
            outline:none; border-color:var(--primary-teal); background:rgba(15,20,25,.95);
            box-shadow:0 0 0 3px rgba(83,119,128,.1), 0 0 20px rgba(83,119,128,.2), inset 0 1px 0 rgba(255,255,255,.05);
            transform:translateY(-1px);
        }
        textarea{ min-height:100px; resize:vertical; line-height:1.5; }
        select{ cursor:pointer; padding-right:40px; background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%2369939D' d='M6 9L1 4h10z'/%3E%3C/svg%3E"); background-repeat:no-repeat; background-position:right 15px center; appearance:none; }
        select option{ background:var(--bg-card); color:var(--text-primary); padding:10px; }

        /* File input */
        input[type="file"]{ width:100%; padding:12px; background:transparent; border:2px dashed rgba(83,119,128,.3); border-radius:12px; color:var(--text-secondary); cursor:pointer; transition:all .3s ease; }
        input[type="file"]:hover{ border-color:var(--primary-teal); background:rgba(83,119,128,.05); }
        input::file-selector-button{
            padding:8px 16px; margin-right:15px; background:linear-gradient(135deg,var(--primary-teal),var(--primary-teal-dark));
            color:#fff; border:none; border-radius:8px; font-family:'Oxanium',monospace; font-weight:600; font-size:.9em; cursor:pointer; transition:all .3s ease; text-transform:uppercase; letter-spacing:.5px;
        }
        input::file-selector-button:hover{ background:linear-gradient(135deg,var(--primary-teal-light),var(--primary-teal)); transform:translateY(-1px); box-shadow:0 4px 12px rgba(83,119,128,.3); }

        /* Buttons */
        button{
            background:linear-gradient(135deg,var(--primary-teal),var(--primary-teal-dark)); color:#fff;
            padding:16px 40px; border:none; border-radius:12px; font-family:'Oxanium',monospace; font-size:1.1em; font-weight:700;
            cursor:pointer; text-transform:uppercase; letter-spacing:1px; transition:all .3s cubic-bezier(.4,0,.2,1); position:relative; overflow:hidden;
            box-shadow:0 4px 15px rgba(83,119,128,.3), inset 0 1px 0 rgba(255,255,255,.1); margin:10px 5px;
        }
        button::before{ content:''; position:absolute; top:0; left:-100%; width:100%; height:100%; background:linear-gradient(90deg,transparent,rgba(255,255,255,.2),transparent); transition:left .5s ease; }
        button:hover{ background:linear-gradient(135deg,var(--primary-teal-light),var(--primary-teal)); transform:translateY(-2px) scale(1.02); box-shadow:0 8px 25px rgba(83,119,128,.4), 0 0 40px rgba(83,119,128,.2), inset 0 1px 0 rgba(255,255,255,.2) }
        button:hover::before{ left:100% }
        button:active{ transform:translateY(0) scale(1); box-shadow:0 2px 10px rgba(83,119,128,.3), inset 0 1px 0 rgba(255,255,255,.1) }

        /* Tooltip */
        .infolink:after{
            content:'?'; display:inline-block; font-family:'Oxanium',monospace; font-weight:bold; text-align:center; font-size:.75em; line-height:1.2em; width:1.2em; height:1.2em; border-radius:50%;
            margin-left:8px; color:var(--primary-teal); border:2px solid var(--primary-teal); background:rgba(83,119,128,.1); cursor:help; transition:all .3s ease;
        }
        .infolink:hover:after{ background:var(--primary-teal); color:#fff; transform:scale(1.1); box-shadow:0 0 15px rgba(83,119,128,.5); }
        .hide{ display:none; position:absolute; background:var(--bg-card); border:1px solid var(--primary-teal); border-radius:8px; padding:12px; margin-top:5px; font-size:.9em; color:var(--text-secondary); box-shadow:0 10px 30px rgba(0,0,0,.5); z-index:1000; max-width:300px; backdrop-filter:blur(10px); }
        .infolink:hover + .hide{ display:block; animation:tooltipFade .3s ease; }
        @keyframes tooltipFade{ from{opacity:0; transform:translateY(-10px)} to{opacity:1; transform:translateY(0)} }

        /* Timeline */
        .bottom{
            background:linear-gradient(135deg, rgba(15,20,25,.9) 0%, rgba(6,8,9,.9) 100%);
            border:1px solid var(--border-subtle); border-radius:20px; padding:30px; margin:20px; min-height:200px;
            box-shadow:0 10px 40px rgba(0,0,0,.5), inset 0 1px 0 rgba(255,255,255,.05); backdrop-filter:blur(10px); overflow-x:auto; position:relative;
        }
        .bottom::-webkit-scrollbar{ height:8px } .bottom::-webkit-scrollbar-track{ background:rgba(83,119,128,.1); border-radius:4px }
        .bottom::-webkit-scrollbar-thumb{ background:var(--primary-teal-dark); border-radius:4px } .bottom::-webkit-scrollbar-thumb:hover{ background:var(--primary-teal) }
        img.shot{ width:auto; height:auto; max-height:150px; max-width:100%; margin-right:20px; border-radius:12px; border:2px solid var(--border-subtle); transition:all .3s cubic-bezier(.4,0,.2,1); box-shadow:0 5px 15px rgba(0,0,0,.3); cursor:pointer; }
        img.shot:hover{ border-color:var(--primary-teal); transform:scale(1.05) translateY(-5px); box-shadow:0 10px 30px rgba(0,0,0,.5), 0 0 30px rgba(83,119,128,.3) }
        .draggable{ display:inline-block; position:relative; margin:10px; animation:slideIn .5s ease-out; }
        @keyframes slideIn{ from{opacity:0; transform:translateX(-30px)} to{opacity:1; transform:translateX(0)} }
        .bottom-right{ position:absolute; bottom:15px; right:15px; font-weight:700; color:var(--success); background:rgba(0,0,0,.7); padding:6px 12px; border-radius:6px; font-size:.85em; text-transform:uppercase; letter-spacing:.5px; backdrop-filter:blur(10px); border:1px solid rgba(0,255,136,.3); animation:statusPulse 2s ease-in-out infinite; }
        @keyframes statusPulse{ 0%,100%{opacity:.9; box-shadow:0 0 10px rgba(0,255,136,.3)} 50%{opacity:1; box-shadow:0 0 20px rgba(0,255,136,.5)} }

        /* >>> New desktop layout rules for two-up rows <<< */
        .row-container{ display:flex; gap:20px; align-items:flex-start; margin:10px 0; }
        .half-field{ flex:1; min-width:0; }
        .half-field .left{ width:200px; margin-bottom:0; }
        .half-field .right{ width:calc(100% - 220px); padding-right:0; margin-bottom:0; }

        /* Responsive */
        @media (max-width:768px){
            .left{ width:100%; margin-bottom:10px; }
            .right{ width:100%; padding-right:0; }
            h2{ font-size:1.8em } .top{ padding:20px } button{ width:100%; margin:10px 0 }
            .row-container{ flex-direction:column; gap:0 }
            .half-field{ width:100% }
        }
    </style>
</head>
<body>
<div class="top">
    <div style="text-align:left;display:inline-block;width:100%;max-width:1400px;">
        <h2 style="padding-left:0%;">Create Scene</h2>

        <div class="left">Select a Node:</div>
        <div class="right">
            <select id="server">
                <option value="https://gpunodemozevnq6gyvjr-f480cb81f0800394.tec-s20.onthetaedgecloud.com">https://gpunodemozevnq6gyvjr-f480cb81f0800394.tec-s20.onthetaedgecloud.com</option>
            </select>
        </div>

        <div class="left">Select A Face:</div>
        <div class="right"><input type="file" id="imageInput" name="imageInput" accept="image/png, image/jpeg"></div>

	<div class="left">Select Clothing:</div>
        <div class="right"><input type="file" id="imageInput2" name="imageInput2" accept="image/png, image/jpeg"></div>

	<div class="left">Select A Background:</div>
        <div class="right"><input type="file" id="imageInput3" name="imageInput3" accept="image/png, image/jpeg"></div>

        <div class="left">Positive Prompt</div>
        <div class="right"><textarea id="positivePrompt" style="width:100%;min-height:160px;"></textarea></div>

        <div class="left">Negative Prompt</div>
        <div class="right">
            <textarea id="negativePrompt" style="width:100%;min-height:102px;">missing limbs, extra limbs, bad anatomy, deformed, disfigured, blurry, low resolution, ugly, noisy, grainy, watermark, text, signature, worst quality, low quality, jpeg artifacts, oversaturated, grayscale, monochrome, fake, surreal, cartoon, anime, 3d render, CGI</textarea>
        </div>

        <!-- Height + Width -->
        <div class="row-container">
            <div class="half-field">
                <div class="left">Height</div>
                <div class="right"><input type="text" id="height" value="576"></div>
            </div>
            <div class="half-field">
                <div class="left">Width</div>
                <div class="right"><input type="text" id="width" value="1024"></div>
            </div>
        </div>

        <!-- Steps + Frames -->
        <div class="row-container">
            <div class="half-field">
                <div class="left">Steps</div>
                <div class="right"><input type="text" id="steps" value="10"></div>
            </div>
            <div class="half-field">
                <div class="left">Frames</div>
                <div class="right"><input type="text" id="frames" value="81"></div>
            </div>
        </div>

        <div class="left">Frame per second</div>
        <div class="right"><input type="text" id="frameRate" value="13"></div>

        <center><button onclick="upload()" class="glow">Generate Shot</button></center>
    </div>

    <div style="display:inline:block;float:left;"><img src="./scaine.png" style="width:100px;"></div>
</div>

<div>
    <div><h2 style="width:300px;display:inline-block;">Timeline</h2>
        <div style="float:right; display:inline-block;margin-right:2%;">
            <!-- icons trimmed for brevity -->
        </div>
    </div>
    <div class="bottom" id="bottom"></div>
</div>

<script>
  
var imageLoc = 0;
    async function prompt(){
        var imageInput = document.getElementById("imageInput").files[0].name;
        var positive = document.getElementById("positivePrompt").value;
        var negative = document.getElementById("negativePrompt").value;
        var steps = document.getElementById("steps").value;
        var height = document.getElementById("height").value;
        var width = document.getElementById("width").value;
        var frames = document.getElementById("frames").value;
        var frameRate = document.getElementById("frameRate").value;

        var image2video = {
  "11": {
    "inputs": {
      "model_name": "umt5-xxl-enc-bf16.safetensors",
      "precision": "bf16",
      "load_device": "offload_device",
      "quantization": "disabled"
    },
    "class_type": "LoadWanVideoT5TextEncoder",
    "_meta": {
      "title": "WanVideo T5 Text Encoder Loader"
    }
  },
  "16": {
    "inputs": {
      "positive_prompt": "\n\n\n",
      "negative_prompt": "",
      "force_offload": true,
      "use_disk_cache": false,
      "device": "gpu",
      "t5": [
        "11",
        0
      ]
    },
    "class_type": "WanVideoTextEncode",
    "_meta": {
      "title": "WanVideo TextEncode"
    }
  },
  "22": {
    "inputs": {
      "model": "wan2114BFusionx_fusionxPhantomv1.safetensors",
      "base_precision": "fp16_fast",
      "quantization": "fp8_e4m3fn",
      "load_device": "offload_device",
      "attention_mode": "sageattn",
      "compile_args": [
        "35",
        0
      ]
    },
    "class_type": "WanVideoModelLoader",
    "_meta": {
      "title": "WanVideo Model Loader"
    }
  },
  "27": {
    "inputs": {
      "steps": 8,
      "cfg": 1,
      "shift": 2.0000000000000004,
      "seed": 24231113028925,
      "force_offload": false,
      "scheduler": "unipc",
      "riflex_freq_index": 0,
      "denoise_strength": 1,
      "batched_cfg": false,
      "rope_function": "comfy",
      "start_step": 0,
      "end_step": -1,
      "add_noise_to_samples": false,
      "model": [
        "22",
        0
      ],
      "image_embeds": [
        "74",
        0
      ],
      "text_embeds": [
        "16",
        0
      ]
    },
    "class_type": "WanVideoSampler",
    "_meta": {
      "title": "WanVideo Sampler"
    }
  },
  "28": {
    "inputs": {
      "enable_vae_tiling": false,
      "tile_x": 272,
      "tile_y": 272,
      "tile_stride_x": 144,
      "tile_stride_y": 128,
      "normalization": "default",
      "vae": [
        "38",
        0
      ],
      "samples": [
        "27",
        0
      ]
    },
    "class_type": "WanVideoDecode",
    "_meta": {
      "title": "WanVideo Decode"
    }
  },
  "35": {
    "inputs": {
      "backend": "inductor",
      "fullgraph": false,
      "mode": "default",
      "dynamic": false,
      "dynamo_cache_size_limit": 64,
      "compile_transformer_blocks_only": true,
      "dynamo_recompile_limit": 128
    },
    "class_type": "WanVideoTorchCompileSettings",
    "_meta": {
      "title": "WanVideo Torch Compile Settings"
    }
  },
  "38": {
    "inputs": {
      "model_name": "Wan2_1_VAE_bf16.safetensors",
      "precision": "bf16"
    },
    "class_type": "WanVideoVAELoader",
    "_meta": {
      "title": "WanVideo VAE Loader"
    }
  },
  "56": {
    "inputs": {
      "enable_vae_tiling": true,
      "tile_x": 272,
      "tile_y": 272,
      "tile_stride_x": 144,
      "tile_stride_y": 128,
      "noise_aug_strength": 0,
      "latent_strength": 1,
      "vae": [
        "38",
        0
      ],
      "image": [
        "77",
        0
      ]
    },
    "class_type": "WanVideoEncode",
    "_meta": {
      "title": "WanVideo Encode"
    }
  },
  "57": {
    "inputs": {
      "image": imageInput
    },
    "class_type": "LoadImage",
    "_meta": {
      "title": "Load Image"
    }
  },
  "61": {
    "inputs": {
      "value": 1024
    },
    "class_type": "INTConstant",
    "_meta": {
      "title": "Width"
    }
  },
  "62": {
    "inputs": {
      "value": 576
    },
    "class_type": "INTConstant",
    "_meta": {
      "title": "Height"
    }
  },
  "74": {
    "inputs": {
      "num_frames": 121,
      "phantom_cfg_scale": 5,
      "phantom_start_percent": 0,
      "phantom_end_percent": 1,
      "phantom_latent_1": [
        "56",
        0
      ],
      "phantom_latent_2": [
        "225",
        0
      ],
      "phantom_latent_3": [
        "231",
        0
      ]
    },
    "class_type": "WanVideoPhantomEmbeds",
    "_meta": {
      "title": "WanVideo Phantom Embeds"
    }
  },
  "77": {
    "inputs": {
      "width": [
        "61",
        0
      ],
      "height": [
        "62",
        0
      ],
      "upscale_method": "lanczos",
      "keep_proportion": "pad",
      "pad_color": "0, 0, 0",
      "crop_position": "top",
      "divisible_by": 16,
      "device": "cpu",
      "image": [
        "57",
        0
      ]
    },
    "class_type": "ImageResizeKJv2",
    "_meta": {
      "title": "Resize Image v2"
    }
  },
  "199": {
    "inputs": {
      "frame_rate": 13,
      "loop_count": 0,
      "filename_prefix": "PhantomMergeTest/Stitched",
      "format": "video/h264-mp4",
      "pix_fmt": "yuv420p",
      "crf": 19,
      "save_metadata": true,
      "trim_to_audio": false,
      "pingpong": false,
      "save_output": true,
      "images": [
        "28",
        0
      ]
    },
    "class_type": "VHS_VideoCombine",
    "_meta": {
      "title": "Video Combine 🎥🅥🅗🅢"
    }
  },
  "224": {
    "inputs": {
      "image": imageInput2
    },
    "class_type": "LoadImage",
    "_meta": {
      "title": "Load Image"
    }
  },
  "225": {
    "inputs": {
      "enable_vae_tiling": true,
      "tile_x": 272,
      "tile_y": 272,
      "tile_stride_x": 144,
      "tile_stride_y": 128,
      "noise_aug_strength": 0,
      "latent_strength": 1,
      "vae": [
        "38",
        0
      ],
      "image": [
        "226",
        0
      ]
    },
    "class_type": "WanVideoEncode",
    "_meta": {
      "title": "WanVideo Encode"
    }
  },
  "226": {
    "inputs": {
      "width": [
        "61",
        0
      ],
      "height": [
        "62",
        0
      ],
      "upscale_method": "lanczos",
      "keep_proportion": "pad",
      "pad_color": "0, 0, 0",
      "crop_position": "center",
      "divisible_by": 16,
      "device": "cpu",
      "image": [
        "224",
        0
      ]
    },
    "class_type": "ImageResizeKJv2",
    "_meta": {
      "title": "Resize Image v2"
    }
  },
  "229": {
    "inputs": {
      "image": imageInput3
    },
    "class_type": "LoadImage",
    "_meta": {
      "title": "Load Image"
    }
  },
  "230": {
    "inputs": {
      "width": [
        "61",
        0
      ],
      "height": [
        "62",
        0
      ],
      "upscale_method": "lanczos",
      "keep_proportion": "pad",
      "pad_color": "0, 0, 0",
      "crop_position": "center",
      "divisible_by": 16,
      "device": "cpu",
      "image": [
        "229",
        0
      ]
    },
    "class_type": "ImageResizeKJv2",
    "_meta": {
      "title": "Resize Image v2"
    }
  },
  "231": {
    "inputs": {
      "enable_vae_tiling": true,
      "tile_x": 272,
      "tile_y": 272,
      "tile_stride_x": 144,
      "tile_stride_y": 128,
      "noise_aug_strength": 0,
      "latent_strength": 1,
      "vae": [
        "38",
        0
      ],
      "image": [
        "230",
        0
      ]
    },
    "class_type": "WanVideoEncode",
    "_meta": {
      "title": "WanVideo Encode"
    }
  }
};

async function sendComfyUIWorkflow(workflowJson) {
  var comfyUIApiUrl = document.getElementById("server").value.concat("/prompt");

  try {
    const response = await fetch(comfyUIApiUrl, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify({
        prompt: workflowJson, // The API-formatted workflow JSON goes here
      }),
    });

    if (!response.ok) {
      throw new Error(`HTTP error! status: ${response.status}`);
    }

    const data = await response.json();
    console.log('Workflow queued successfully:', data);
    return data;
  } catch (error) {
    console.error('Error sending workflow to ComfyUI:', error);
    throw error;
  }
}

sendComfyUIWorkflow(image2video)
   .then(result => {
	 console.log('Result:', result);
	 loadImage("imageInput",result.prompt_id);
    })
   .catch(error => console.error('Failed to send workflow:', error));
loadImage("imageInput",900);
}

var imageData;
async function loadImage(file_location,promptID){
	document.getElementById("bottom").innerHTML = document.getElementById("bottom").innerHTML.concat("<div class='draggable' draggable='true'><a id='link",imageLoc,"'><img class='shot' src=",imageData," /></a><div class='bottom-right' id='status",imageLoc,"'>Processing</div><input type='hidden' id='id",imageLoc,"' value='",promptID,"'><input type='hidden' id='sound",imageLoc,"' value='",soundFile,"'></div><input type='hidden' id='video",imageLoc,"' value=''><input type='hidden' id='soundFinal",imageLoc,"' value=''><input type='hidden' id='active",imageLoc,"' value=''></div>");
console.log(file_location);
imageLoc++;
  const defaultFile = document.getElementById(file_location);
  const file = defaultFile.files[0];
  if (file && file.type.startsWith('image/')) {
    imageToBase64FileReader(file, (base64String) => {
      imageData = base64String;
	document.getElementById("bottom").innerHTML = document.getElementById("bottom").innerHTML.concat("<div class='draggable' draggable='true'><a id='link",imageLoc,"'><img class='shot' src=",imageData," /></a><div class='bottom-right' id='status",imageLoc,"'>Processing</div><input type='hidden' id='id",imageLoc,"' value='",promptID,"'><input type='hidden' id='sound",imageLoc,"' value='",soundFile,"'></div><input type='hidden' id='video",imageLoc,"' value=''><input type='hidden' id='soundFinal",imageLoc,"' value=''><input type='hidden' id='active",imageLoc,"' value=''></div>");   
});
setTimeout(function(){
    checkJob(); 
}, 10000); 
  } else {
    console.log('Please select an image file.');
    document.getElementById(image).style.display = "none";
  }
 fetch("http://scaine.io/scaine/api/request/?id=".concat(promptID,"&sound=",soundFile,"&node=",document.getElementById("server").value))
  .then((response) => response.json())
  .then((json) => console.log(json));
console.log("http://scaine.io/scaine/api/request/?id=".concat(promptID,"&sound=",soundFile,"&node=",document.getElementById("server").value));

};



async function checkJob() {
var counter = 0;
var restart = 0;
for (let i = 1; i <= imageLoc; i++) {
console.log(imageLoc);
var promptID = document.getElementById("id".concat(i)).value;
var soundLocation = document.getElementById("soundFinal".concat(i)).value;
 if (soundLocation == ""){
  var comfyUIApiUrl = document.getElementById("server").value.concat("/history");
  fetch(comfyUIApiUrl)
    .then(function(serverPromise){ 
      serverPromise.json()
        .then(function(j) { 
	  console.log(j);
          for (let key in j) {
		console.log(j);
        	if (j['soundFile'].length > 6){
			counter++;
			document.getElementById("status".concat(i)).value = "Complete";
			if (counter == 1){ document.getElementById('link'.concat(i)).href = document.getElementById("server").concat("/api/view?filename=",j[promptID]['outputs'][41]['gifs'][0]['filename']); 
			document.getElementById('status'.concat(i)).innerHTML = "Complete"; }
			return;
		}else{
			if (restart == 0){setTimeout(checkJob, 20000);restart = 100; }	
			j = [];
		}
		
   	  }
        })
        .catch(function(e){
          console.log(e);
	  if (restart == 0){setTimeout(checkJob, 20000);restart = 100; }
        });
    })
    .catch(function(e){
        console.log(e);
	if (restart == 0){setTimeout(checkJob, 20000);restart = 100; }
      });
}
}  
}

function imageToBase64FileReader(file, callback) {
  const reader = new FileReader();
  reader.onload = function(e) {
    callback(e.target.result); 
  };
  reader.readAsDataURL(file);
}


async function upload(){
  const selectedFile = document.getElementById('imageInput').files[0];
  if (selectedFile) {
    try {
      const uploadResult = await uploadImageToComfyUI(selectedFile);
      console.log("uploaded file name:");
      console.log(uploadResult.name);
    } catch (error) {
      console.log(error)
    }
  }
upload2();
}

async function upload2(){
  const selectedFile = document.getElementById('imageInput2').files[0];
  if (selectedFile) {
    try {
      const uploadResult = await uploadImageToComfyUI(selectedFile);
      console.log("uploaded file name:");
      console.log(uploadResult.name);
    } catch (error) {
      console.log(error)
    }
  }
upload3();
}
async function upload3(){
  const selectedFile = document.getElementById('imageInput3').files[0];
  if (selectedFile) {
    try {
      const uploadResult = await uploadImageToComfyUI(selectedFile);
      console.log("uploaded file name:");
      console.log(uploadResult.name);
    } catch (error) {
      console.log(error)
    }
  }
prompt();
}

async function uploadImageToComfyUI(file) {
  var comfyUIApiUrl = document.getElementById("server").value.concat("/upload/image");

  const formData = new FormData();
  formData.append('image', file); // 'image' is the expected field name for the image file
  formData.append('type', 'input'); // Specifies the target folder (e.g., 'input', 'temp', 'output')
  formData.append('subfolder', ''); // Optional: specify a subfolder within the 'type' folder
  formData.append('overwrite', 'false'); // Optional: set to 'true' to overwrite existing files

  try {
    const response = await fetch(comfyUIApiUrl, {
      method: 'POST',
      body: formData,
    });

    if (!response.ok) {
      throw new Error(`HTTP error! status: ${response.status}`);
    }

    const result = await response.json();
    console.log('Image upload successful:', result);
    return result;
  } catch (error) {
    console.error('Error uploading image:', error);
    throw error;
  }
}

  const container = document.getElementById('bottom');
        let dragged = null;

        container.addEventListener('dragstart', (e) => {
            if (e.target.classList.contains('draggable')) {
                dragged = e.target;
                e.dataTransfer.effectAllowed = 'move';
            }
        });

        container.addEventListener('dragover', (e) => {
            e.preventDefault();
            const target = e.target.closest('.draggable');
            if (target && target !== dragged) {
                target.classList.add('drag-over');
            }
        });

        container.addEventListener('dragleave', (e) => {
            const target = e.target.closest('.draggable');
            if (target) {
                target.classList.remove('drag-over');
            }
        });

        container.addEventListener('drop', (e) => {
            e.preventDefault();
            const target = e.target.closest('.draggable');
            if (target && target !== dragged) {
                target.classList.remove('drag-over');
                const children = Array.from(container.children);
                const draggedIndex = children.indexOf(dragged);
                const targetIndex = children.indexOf(target);
                if (draggedIndex < targetIndex) {
                    container.insertBefore(dragged, target.nextSibling);
                } else {
                    container.insertBefore(dragged, target);
                }
            }
        });

        container.addEventListener('dragend', () => {
            document.querySelectorAll('.drag-over').forEach(el => el.classList.remove('drag-over'));
            dragged = null;
        });

</script>
</body>
</html>
